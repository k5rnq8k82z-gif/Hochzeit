<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin â€“ Hochzeit Maria & Kim</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg: #0b0f16; --fg: #eef2fa; --muted: #aab0c0;
    --accent1:#7ad9ff; --accent2:#ff86c8;
    --card: rgba(255,255,255,0.06);
    --edge: rgba(255,255,255,0.12);
    --radius: 14px; --shadow: 0 16px 38px rgba(0,0,0,.4);
  }
  html,body{margin:0;padding:0;background:linear-gradient(180deg,#080a0f,#0c1119);color:var(--fg);
    font-family:Inter,ui-sans-serif,system-ui,sans-serif;min-height:100vh;}
  header{position:sticky;top:0;background:rgba(8,12,20,.7);backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(255,255,255,.1);padding:12px 24px;font-weight:700;letter-spacing:.4px;
    display:flex;justify-content:space-between;align-items:center;}
  header a{color:var(--accent1);text-decoration:none;}
  main{max-width:1100px;margin:0 auto;padding:24px;}
  .card{background:var(--card);border:1px solid var(--edge);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:20px;margin-bottom:24px;}
  .row{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px;}
  input,button{font:inherit;border-radius:10px;padding:10px 14px;}
  input[type=text]{flex:1;min-width:200px;background:rgba(255,255,255,.08);border:1px solid var(--edge);color:var(--fg);}
  button{border:0;font-weight:700;cursor:pointer;}
  .btn{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#081019;
    box-shadow:0 6px 18px rgba(122,217,255,.2);}
  .btn.ghost{background:transparent;color:var(--fg);border:1px solid var(--edge);}
  .hint{color:var(--muted);font-size:14px;}
  table{width:100%;border-collapse:collapse;font-size:14px;}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
  th{color:var(--accent1);}
</style>
</head>
<body>
<header>
  <div>ðŸŒ´ Adminpanel â€“ Maria & Kim</div>
  <a href="index.html">ZurÃ¼ck zur Seite</a>
</header>
<main>

  <section class="card">
    <h2>RSVP-Ãœbersicht</h2>
    <div class="row">
      <input id="admToken" type="text" placeholder="Admin-Token (z. B. 030520)">
      <button class="btn" id="admLoad">Laden</button>
      <button class="btn ghost" id="admCsv">CSV exportieren</button>
    </div>
    <p class="hint" id="admHint"></p>
    <div style="overflow:auto;margin-top:12px;">
      <table id="admTable">
        <thead><tr>
          <th>Zeit</th><th>Name</th><th>Zusage</th><th>Begleiter</th>
          <th>Begleit-Infos</th><th>E-Mail</th><th>Nachricht</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <h2>GÃ¤stebuch / Chat</h2>
    <div class="row">
      <input id="admTokenChat" type="text" placeholder="Admin-Token">
      <button class="btn" id="admLoadChat">Laden</button>
    </div>
    <p class="hint" id="admChatHint"></p>
    <div id="admChatList" style="display:grid;gap:10px;margin-top:10px;"></div>
  </section>

</main>
<script>
const SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycbzFiGVXqdeDVQH7cENcb123mg4at0I9Xhjv-D599mkVkqUSMtSygDhgIUmP29PVS9CP/exec";

document.getElementById('admLoad').onclick = loadRSVP;
document.getElementById('admCsv').onclick = exportCsv;
document.getElementById('admLoadChat').onclick = loadChat;

async function loadRSVP(){
  const token=document.getElementById('admToken').value.trim();
  const hint=document.getElementById('admHint');
  const tbody=document.querySelector('#admTable tbody');
  hint.textContent="Ladeâ€¦"; tbody.innerHTML="";
  try{
    const url=new URL(SHEET_ENDPOINT);
    url.searchParams.set("token",token);
    url.searchParams.set("type","rsvp");
    const res=await fetch(url); const j=await res.json();
    if(!j.ok) throw new Error(j.error||"Fehler");
    const rows=j.rows||[];
    for(const r of rows){
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${r.timestamp||''}</td><td>${r.name||''}</td><td>${r.attending||''}</td>
      <td>${r.guests||''}</td>
      <td>${[r.c1name,r.c1age,r.c2name,r.c2age,r.c3name,r.c3age,r.c4name,r.c4age].filter(Boolean).join(' â€¢ ')}</td>
      <td>${r.email||''}</td><td>${r.message||''}</td>`;
      tbody.appendChild(tr);
    }
    hint.textContent=`${rows.length} EintrÃ¤ge geladen.`;
  }catch(e){hint.textContent="Fehler beim Laden â€“ Token korrekt?";console.error(e);}
}

function exportCsv(){
  const rows=[["timestamp","name","attending","guests","companions","email","message"]];
  document.querySelectorAll('#admTable tbody tr').forEach(tr=>{
    const cells=[...tr.children].map(td=>td.textContent);
    rows.push(cells);
  });
  const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=Object.assign(document.createElement('a'),{href:url,download:'rsvps.csv'});
  document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
}

async function loadChat(){
  const token=document.getElementById('admTokenChat').value.trim();
  const hint=document.getElementById('admChatHint');
  const list=document.getElementById('admChatList');
  hint.textContent="Ladeâ€¦"; list.innerHTML="";
  try{
    const url=new URL(SHEET_ENDPOINT);
    url.searchParams.set("token",token);
    url.searchParams.set("type","chat");
    const res=await fetch(url); const j=await res.json();
    if(!j.ok) throw new Error(j.error||"Fehler");
    (j.rows||[]).slice(-100).reverse().forEach(r=>{
      const div=document.createElement('div');
      div.className='card';
      div.innerHTML=`<strong>${r.name||'Gast'}</strong><div class="hint">${r.message||''}</div>`;
      list.appendChild(div);
    });
    hint.textContent=`${(j.rows||[]).length} Nachrichten geladen.`;
  }catch(e){hint.textContent="Chat laden fehlgeschlagen â€“ Token prÃ¼fen.";console.error(e);}
}
</script>
</body>
</html>
