
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Admin – Hochzeit</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg: #0c1016;
      --card: rgba(255,255,255,0.07);
      --fg: #eef2fa;
      --muted:#aab0c0;
      --brand:#ff8fb2;
      --brand2:#78d3ff;
      --accent:#ffd166;
      --ok:#39d353;
      --warn:#ffcc00;
      --error:#ff6b6b;
      --shadow: 0 12px 34px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html,body { margin:0; padding:0; color:var(--fg);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(1600px 800px at 10% -10%, rgba(255,143,178,.08), transparent 60%),
        radial-gradient(1400px 700px at 110% 0%, rgba(120,211,255,.08), transparent 60%),
        linear-gradient(180deg, #0c1016 0%, #0f1117 60%, #0b0e14 100%) no-repeat;
      min-height: 100vh;
    }
    a { color: var(--brand2); text-decoration: none; }
    img { max-width:100%; display:block; border-radius: 14px; }

    .thai {
      background:
        url('img/thai_border.svg') center top/280px repeat-x,
        url('img/thai_border.svg') center bottom/280px repeat-x;
      padding-top: 24px; padding-bottom: 24px;
    }

    #splash{
      position:fixed; inset:0; z-index:1000;
      background: #000 url('img/hero.jpg') center/cover no-repeat;
      display:grid; place-items:center;
      transition: opacity .9s ease;
    }
    #splash::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.55));
    }
    #splash .title{
      position:relative; z-index:2; text-align:center;
      padding:16px 24px; border-radius:999px;
      background: rgba(255,255,255,.14); backdrop-filter: blur(8px);
      box-shadow: var(--shadow);
      font-weight:800; letter-spacing:.6px;
    }
    #splash.hide{ opacity:0; pointer-events:none; }

    header{
      position:sticky; top:0; z-index:20;
      background:rgba(15,17,21,.55); backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:20px; }
    nav{ display:flex; align-items:center; gap:14px; justify-content:space-between; }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.3px; }
    .brand .dot{ width:12px; height:12px; border-radius:50%;
      background: conic-gradient(from 45deg, var(--brand), var(--brand2), var(--accent));
      box-shadow:0 0 22px rgba(255,143,178,.8);
    }
    .navlinks a{ padding:8px 12px; border-radius:10px; }
    .navlinks a:hover{ background:rgba(255,255,255,.07); }

    .hero{ padding:64px 20px 18px; text-align:center; }
    .hero h1{ font-size: clamp(28px, 6vw, 52px); margin:0 0 8px; }
    .hero p{ color:var(--muted); margin:0; }

    section{ padding:28px 20px 18px; }
    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .grid{ display:grid; gap:18px; grid-template-columns: repeat(12, 1fr); }
    .col-12{ grid-column: span 12; }
    .col-6{ grid-column: span 12; }
    @media(min-width:860px){ .col-6{ grid-column: span 6; } }

    form label{ display:block; font-weight:700; margin:12px 0 6px; }
    input[type="text"], input[type="email"], textarea, select, input[type="number"]{
      width:100%; padding:12px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.07); color:var(--fg);
      outline:none;
    }
    textarea{ min-height:90px; resize:vertical; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; }
    .row > *{ flex:1; min-width:160px; }
    .radios{ display:flex; gap:12px; flex-wrap: wrap; }
    .chip{
      display:inline-flex; align-items:center; gap:10px; padding:10px 14px;
      border-radius:999px; border:1px solid rgba(255,255,255,.12); cursor:pointer;
      background:rgba(255,255,255,.06);
    }
    .chip input{ display:none; }
    .chip[data-checked="true"]{ outline:2px solid rgba(255,255,255,.2); background:rgba(255,255,255,.12); }
    .hint{ color:var(--muted); font-size:14px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      border:0; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800;
      color:#0c0f14; background:linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 10px 20px rgba(255,137,168,.25), 0 6px 18px rgba(138,198,255,.18);
    }
    .btn.ghost{ background: transparent; color:var(--fg); border:1px solid rgba(255,255,255,.18); }
    .success{ color: var(--ok); font-weight:700; }
    .error{ color: var(--error); font-weight:700; }
    .warn{ color: var(--warn); font-weight:700; }

    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
    }

    .gallery{ display:grid; gap:10px; grid-template-columns: repeat(2, 1fr); }
    @media(min-width:700px){ .gallery{ grid-template-columns: repeat(4, 1fr); } }
    .gallery img{ border-radius:12px; aspect-ratio: 1/1; object-fit:cover; cursor:pointer; }

    .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:50; }
    .lightbox.show{ display:flex; }
    .lightbox img{ max-width:90vw; max-height:80vh; border-radius:14px; }
    .lightbox .close{ position:absolute; top:14px; right:18px; font-size:28px; cursor:pointer; }

    footer{ padding:60px 20px; text-align:center; color:var(--muted); }
  </style>

</head>
<body>
  <header class="thai">
    <div class="wrap">
      <nav>
        <div class="brand"><span class="dot"></span> <span>Admin</span></div>
        <div class="navlinks">
          <a href="index.html">Zur Website</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2>RSVP-Übersicht</h2>
      <div class="row">
        <input id="admToken" type="text" placeholder="Admin-Token (wie im Script gesetzt)">
        <button class="btn" id="admLoad">Laden</button>
        <button class="btn ghost" id="admCsv">CSV exportieren</button>
      </div>
      <p class="hint" id="admHint" style="margin-top:8px;"></p>
      <div style="overflow:auto; margin-top:12px;">
        <table id="admTable" aria-label="RSVP-Tabelle" style="width:100%; border-collapse:collapse;">
          <thead><tr>
            <th style="text-align:left;padding:8px;">Zeit</th>
            <th style="text-align:left;padding:8px;">Name</th>
            <th style="text-align:left;padding:8px;">Zusage</th>
            <th style="text-align:left;padding:8px;">Begl. Anzahl</th>
            <th style="text-align:left;padding:8px;">Begl. Details</th>
            <th style="text-align:left;padding:8px;">E-Mail</th>
            <th style="text-align:left;padding:8px;">Nachricht</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card" style="margin-top:18px;">
      <h2>Gästebuch / Chat</h2>
      <div class="row">
        <input id="admTokenChat" type="text" placeholder="Admin-Token">
        <button class="btn" id="admLoadChat">Laden</button>
      </div>
      <p class="hint" id="admChatHint" style="margin-top:8px;"></p>
      <div id="admChatList" style="margin-top:10px; display:grid; gap:10px;"></div>
    </section>

    <section class="card" style="margin-top:18px;">
      <h2>Backend (Apps Script) – Vorlage</h2>
      <p class="hint">Kopiere das in dein Apps Script, um <strong>RSVP (mit Begleitungen)</strong> und <strong>Chat</strong> zu unterstützen.</p>
      <pre style="white-space:pre-wrap; font-size:13px; background:rgba(0,0,0,.4); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.1);">
function doPost(e) {{
  var p = e.parameter;
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var type = (p.type || 'rsvp').toLowerCase();
  if (type === 'chat') {{
    var sh = ss.getSheetByName('Chat') || ss.insertSheet('Chat');
    var ts = Utilities.formatDate(new Date(), Session.getScriptTimeZone(), "yyyy-MM-dd HH:mm:ss");
    sh.appendRow([ts, p.name || '', p.message || '', p.ua || '']);
    return ContentService.createTextOutput(JSON.stringify({{ ok:true }})).setMimeType(ContentService.MimeType.JSON);
  }} else {{
    var sh = ss.getSheetByName('RSVP') || ss.insertSheet('RSVP');
    var ts = Utilities.formatDate(new Date(), Session.getScriptTimeZone(), "yyyy-MM-dd HH:mm:ss");
    sh.appendRow([ts, p.name||'', p.attending||'', p.guests||'',
                  p.email||'', p.message||'',
                  p.c1name||'', p.c1age||'', p.c2name||'', p.c2age||'',
                  p.c3name||'', p.c3age||'', p.c4name||'', p.c4age||'',
                  p.ua||'']);
    return ContentService.createTextOutput(JSON.stringify({{ ok:true }})).setMimeType(ContentService.MimeType.JSON);
  }}
}}
function doGet(e) {{
  var p = e.parameter;
  var token = p.token || '';
  var need = PropertiesService.getScriptProperties().getProperty('TOKEN') || '';
  if (!need || token !== need) return ContentService.createTextOutput(JSON.stringify({{ ok:false, error:'Unauthorized' }})).setMimeType(ContentService.MimeType.JSON);
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var type = (p.type || 'rsvp').toLowerCase();
  var sh = ss.getSheetByName(type==='chat' ? 'Chat' : 'RSVP');
  if (!sh) return ContentService.createTextOutput(JSON.stringify({{ ok:true, rows:[] }})).setMimeType(ContentService.MimeType.JSON);
  var values = sh.getDataRange().getValues();
  var header = values.shift();
  var rows = values.map(function(r) {{
    var o = {{}};
    for (var i=0;i<header.length;i++) o[header[i]||('c'+i)] = r[i];
    return o;
  }});
  return ContentService.createTextOutput(JSON.stringify({{ ok:true, rows: rows }})).setMimeType(ContentService.MimeType.JSON);
}}
      </pre>
    </section>
  </main>

  <script>
    const SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycbzFiGVXqdeDVQH7cENcb123mg4at0I9Xhjv-D599mkVkqUSMtSygDhgIUmP29PVS9CP/exec";

    document.getElementById('admLoad').addEventListener('click', loadRSVP);
    document.getElementById('admCsv').addEventListener('click', exportCsv);
    document.getElementById('admLoadChat').addEventListener('click', loadChat);

    async function loadRSVP() {{
      const token = document.getElementById('admToken').value.trim();
      const hint = document.getElementById('admHint');
      const tbody = document.querySelector('#admTable tbody');
      hint.textContent = "Lade...";
      tbody.innerHTML = "";
      try {{
        const url = new URL(SHEET_ENDPOINT);
        url.searchParams.set('token', token);
        url.searchParams.set('type', 'rsvp');
        const res = await fetch(url.toString());
        const j = await res.json();
        if (!j.ok) throw new Error(j.error || "Fehler");
        const rows = j.rows || [];
        for (const r of rows) {{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td style="padding:8px;">${{r.timestamp||''}}</td>
            <td style="padding:8px;">${{r.name||''}}</td>
            <td style="padding:8px;">${{r.attending||''}}</td>
            <td style="padding:8px;">${{r.guests||''}}</td>
            <td style="padding:8px;">${{[r.c1name,r.c1age,r.c2name,r.c2age,r.c3name,r.c3age,r.c4name,r.c4age].filter(Boolean).join(' • ')}}</td>
            <td style="padding:8px;">${{r.email||''}}</td>
            <td style="padding:8px;">${{r.message||''}}</td>
          `;
          tbody.appendChild(tr);
        }}
        hint.textContent = `Einträge: ${{rows.length}}`;
      }} catch(e) {{
        hint.textContent = "Laden fehlgeschlagen – ist TOKEN gesetzt & doGet aktiv?";
      }}
    }}

    function exportCsv() {{
      const rows = Array.from(document.querySelectorAll('#admTable tbody tr')).map(tr => Array.from(tr.children).map(td => td.textContent));
      const header = ['timestamp','name','attending','guests','companions','email','message'];
      const esc = v => `"$` + `{String(v ?? '').replace(/"/g,'""')}"`;
      const lines = [header.join(',')].concat(rows.map(r => r.map(v => `"$` + `{String(v ?? '').replace(/"/g,'""')}"`).join(',')));
      const blob = new Blob([lines.join('\n')], {{ type: 'text/csv;charset=utf-8;' }});
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), {{ href: url, download: 'rsvps.csv' }});
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }}

    async function loadChat() {{
      const token = document.getElementById('admTokenChat').value.trim();
      const hint = document.getElementById('admChatHint');
      const list = document.getElementById('admChatList');
      hint.textContent = "Lade...";
      list.innerHTML = "";
      try {{
        const url = new URL(SHEET_ENDPOINT);
        url.searchParams.set('token', token);
        url.searchParams.set('type', 'chat');
        const res = await fetch(url.toString());
        const j = await res.json();
        if (!j.ok) throw new Error(j.error || "Fehler");
        const rows = j.rows || [];
        rows.slice(-100).reverse().forEach(r => {{
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `<strong>${{r.name||'Gast'}}</strong><div class="hint" style="margin-top:4px;">${{r.message||''}}</div>`;
          list.appendChild(div);
        }});
        hint.textContent = `Chat-Nachrichten: ${{rows.length}}`;
      }} catch(e) {{
        hint.textContent = "Chat laden fehlgeschlagen – Script mit type=chat & TOKEN aktivieren.";
      }}
    }}
  </script>
</body>
</html>
