<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Admin – Maria & Kim</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg0:#080a0f;--bg1:#0c0f16;--fg:#e9eef6;--muted:#a5b0c4;
  --neon1:#7ad9ff;--neon2:#ff86c8;--edge:rgba(255,255,255,.14);
  --card:rgba(255,255,255,.06);--shadow:0 18px 40px rgba(0,0,0,.45);--r:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,var(--bg0),var(--bg1));color:var(--fg);font-family:Inter,ui-sans-serif,system-ui,sans-serif;min-height:100vh}
header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:rgba(8,11,18,.6);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.1)}
header .brand{display:flex;align-items:center;gap:10px;font-weight:800}
header .brand .dot{width:12px;height:12px;border-radius:99px;background:conic-gradient(from 45deg,var(--neon1),var(--neon2));box-shadow:0 0 20px rgba(122,217,255,.7)}
header a{color:var(--neon1);text-decoration:none}
main{max-width:1100px;margin:0 auto;padding:20px}
.grid{display:grid;gap:18px;grid-template-columns:repeat(12,1fr)}
.col-12{grid-column:span 12}.col-6{grid-column:span 12}@media(min-width:900px){.col-6{grid-column:span 6}}
.card{background:var(--card);border:1px solid var(--edge);border-radius:var(--r);box-shadow:var(--shadow);padding:18px}
h2{margin:0 0 10px}
.row{display:flex;flex-wrap:wrap;gap:12px}
input,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--edge);background:rgba(255,255,255,.06);color:var(--fg)}
textarea{min-height:80px}
.btn{border:0;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:800;color:#081019;background:linear-gradient(135deg,var(--neon1),var(--neon2));box-shadow:0 8px 20px rgba(122,217,255,.22)}
.btn.ghost{background:transparent;color:var(--fg);border:1px solid var(--edge);box-shadow:none}
.hint{color:var(--muted);font-size:14px}
table{width:100%;border-collapse:collapse;font-size:14px;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
th{color:var(--neon1)}
.thumb{width:80px;height:80px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,.14)}
#gate{position:fixed;inset:0;background:rgba(6,9,14,.9);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:9999}
#gate .panel{width:min(420px,92vw);background:var(--card);border:1px solid var(--edge);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
</style>
</head>
<body>
<header>
  <div class="brand"><span class="dot"></span> Admin – Maria &amp; Kim</div>
  <a href="index.html">Zur Website</a>
</header>

<main class="grid">
  <!-- Texte -->
  <section class="card col-12">
    <h2>Texte bearbeiten</h2>
    <p class="hint">Diese Texte erscheinen auf der Startseite.</p>
    <div class="grid">
      <div class="col-6"><label>Hero-Unterzeile</label><input id="hero_subtitle"></div>
      <div class="col-6"><label>Dresscode</label><input id="info_dresscode"></div>
      <div class="col-6"><label>Geschenke</label><input id="info_gifts"></div>
      <div class="col-6"><label>Kinder</label><input id="info_kids"></div>
      <div class="col-6"><label>Hashtag</label><input id="info_hashtag"></div>
      <div class="col-12 row"><button class="btn" id="saveTexts">Speichern</button><span class="hint" id="textsStatus"></span></div>
    </div>
  </section>

  <!-- Galerie -->
  <section class="card col-12">
    <h2>Galerie</h2>
    <div class="row"><input type="file" id="files" accept="image/*" multiple><button class="btn" id="uploadBtn">Hochladen</button><span class="hint" id="galleryStatus"></span></div>
    <table><thead><tr><th>Vorschau</th><th>Datei</th><th>URL</th><th>Aktion</th></tr></thead><tbody id="galleryBody"></tbody></table>
  </section>

  <!-- Chat -->
  <section class="card col-12">
    <h2>Chat / Gästebuch</h2>
    <div class="row"><button class="btn" id="loadChat">Neu laden</button><span class="hint" id="chatStatus"></span></div>
    <table><thead><tr><th>Zeit</th><th>Name</th><th>Nachricht</th><th>Aktion</th></tr></thead><tbody id="chatBody"></tbody></table>
  </section>
</main>

<!-- Login -->
<div id="gate"><div class="panel">
  <h2>Admin-Login</h2>
  <p class="hint">Bitte Token eingeben.</p>
  <div class="row"><input id="admToken" placeholder="030520"><button class="btn" id="enterBtn">Login</button></div>
  <p class="hint" id="gateHint"></p>
</div></div>

<script>
const ENDPOINT="https://script.google.com/macros/s/AKfycbzFiGVXqdeDVQH7cENcb123mg4at0I9Xhjv-D599mkVkqUSMtSygDhgIUmP29PVS9CP/exec";
let TOKEN="";

/* Login */
document.getElementById("enterBtn").addEventListener("click",async()=>{
  const t=document.getElementById("admToken").value.trim();
  if(!t){document.getElementById("gateHint").textContent="Token fehlt.";return;}
  try{
    const url=new URL(ENDPOINT);url.searchParams.set("type","texts");url.searchParams.set("list","1");url.searchParams.set("token",t);
    const r=await fetch(url);const j=await r.json();if(!j.ok)throw 0;
    TOKEN=t;document.getElementById("gate").style.display="none";
    fillTexts(j.items||{});listGallery();listChat();
  }catch{document.getElementById("gateHint").textContent="Token ungültig.";}
});

/* Texte */
function fillTexts(it){["hero_subtitle","info_dresscode","info_gifts","info_kids","info_hashtag"].forEach(k=>{if(it[k])document.getElementById(k).value=it[k];});}
document.getElementById("saveTexts").addEventListener("click",async()=>{
  const s=document.getElementById("textsStatus");s.textContent="Speichere…";
  try{
    const body=new URLSearchParams({
      type:"texts_set",token:TOKEN,
      hero_subtitle:hero_subtitle.value||"",info_dresscode:info_dresscode.value||"",
      info_gifts:info_gifts.value||"",info_kids:info_kids.value||"",info_hashtag:info_hashtag.value||""
    });
    const r=await fetch(ENDPOINT,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body});
    const j=await r.json();if(!j.ok)throw 0;s.textContent="Gespeichert ✔";
  }catch{s.textContent="Fehler.";}
});

/* Galerie */
async function listGallery(){
  const b=document.getElementById("galleryBody");b.innerHTML="";
  try{
    const u=new URL(ENDPOINT);u.searchParams.set("type","gallery");u.searchParams.set("list","1");u.searchParams.set("token",TOKEN);
    const r=await fetch(u);const j=await r.json();if(!j.ok)throw 0;
    (j.rows||[]).forEach(x=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td><img class="thumb" src="${x.url}"></td><td>${x.filename}</td><td><a href="${x.url}" target="_blank">${x.url.slice(0,40)}…</a></td><td><button class="btn ghost" data-id="${x.id}">Löschen</button></td>`;
      b.appendChild(tr);
    });
    b.querySelectorAll("[data-id]").forEach(btn=>btn.addEventListener("click",()=>delGallery(btn.dataset.id)));
  }catch{document.getElementById("galleryStatus").textContent="Laden fehlgeschlagen.";}
}
async function delGallery(id){
  if(!confirm("Bild löschen?"))return;
  const body=new URLSearchParams({type:"gallery_delete",token:TOKEN,id});
  await fetch(ENDPOINT,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body});
  listGallery();
}
document.getElementById("uploadBtn").addEventListener("click",async()=>{
  const f=document.getElementById("files").files;const s=document.getElementById("galleryStatus");
  if(!f.length){s.textContent="Keine Datei.";return;}
  s.textContent="Lade hoch…";
  for(const file of f){
    const b64=await toB64(file);
    const body=new URLSearchParams({type:"gallery_upload",token:TOKEN,filename:file.name,mime:file.type,data:b64.split(",")[1]});
    await fetch(ENDPOINT,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body});
  }
  s.textContent="Fertig ✔";listGallery();
});
function toB64(file){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(file);});}

/* Chat */
document.getElementById("loadChat").addEventListener("click",listChat);
async function listChat(){
  const b=document.getElementById("chatBody");b.innerHTML="";
  const s=document.getElementById("chatStatus");s.textContent="Lade…";
  try{
    const u=new URL(ENDPOINT);u.searchParams.set("type","chat");u.searchParams.set("list","1");u.searchParams.set("token",TOKEN);
    const r=await fetch(u);const j=await r.json();if(!j.ok)throw 0;
    (j.rows||[]).forEach(row=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${row.timestamp||""}</td><td>${row.name||""}</td><td>${row.message||""}</td><td><button class="btn ghost" data-row="${row._row}">Löschen</button></td>`;
      b.appendChild(tr);
    });
    b.querySelectorAll("[data-row]").forEach(btn=>btn.addEventListener("click",()=>delChat(btn.dataset.row)));
    s.textContent=j.rows.length+" Nachrichten";
  }catch{s.textContent="Fehler.";}
}
async function delChat(row){
  const body=new URLSearchParams({type:"chat_delete",token:TOKEN,row});
  await fetch(ENDPOINT,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body});
  listChat();
}
</script>
</body>
</html>
